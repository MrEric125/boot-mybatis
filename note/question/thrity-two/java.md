### 计算机基础知识以及Java语言特性

计算机的基础知识是工程师基本能力的体现，也是面试前必须要牢牢掌握的部分。课程结构有这么几点，
分为这么几个模块
1. 知识点汇总（方便你系统化复习）
2. 知识点详解（TCP协议，设计模式，Java基础知识）

#### 知识点汇总
![知识点汇总](../computer_fundation.png) 
##### 操作系统
1. 我们来看看操作系统相关知识汇总。
   
    操作系统知识对于服务问题的排查定位十分重要，在面试时一般以了解和应用考察为主，面试题目占的比重一般不会太高。
    - 进程和线程(非常重要，掌握他们之间的区别和联系)

        进程是系统资源分配的最小单位，线程是程序执行的最小单位。进程使用独立的数据空间，而线程共享进程的数据空间。
2. 线程调度
    - 简单了解线程的几种调度算法
        - 时间片轮转调度
        - 先来先服务调度
        - 优先级调度
        - 多级反馈队列调度
        - 高响应比优先调度
3. 线程切换步骤
4. 进程间的通行(ipc)面试中间件研发的相关职位是经常会考察，需要了解这六种进程通信方式的原理和适用场景，例如竞争间数据共享的场景，可以使用共享内存进程间数据交换的场景，
5. 常用命令(awk、top 、netstat、grep、less、tail)
6. 内存分页管理与swap机制
7. 任务队列与CPU load
8. 拓展知识(如果在面试时有机会谈到的话，会在知识深度上给面试官留下比较好的印象)
    - 内存屏障
    - 指令乱序
    - 分支预测
    - CPU亲和性等
##### 计算机网络
1. 网络协议
    - 网络四七层协议
    - 网络协议详解(Http,TCP)
        - TCP 三次握手，四次挥手
        - naggel 算法和ACk延迟
            - 产生的背景是要解决小包问题
            - 提高数据载荷比
            - 知道对于延迟比较敏感，发送数据频率较低的场景可以关闭negel算法
        - keep-alive
        - TCP 如何通过滑动窗口机制来实现流量控制的
        - HTTP协议
            - 掌握HTTP协议的规范

#### 知识点详解
![]()

这张脑图左上角的进程与线程部分是一个非常重要的考查点，首先需要掌握他们的区别和联系，


第二：计算机网络也是非常重要的基础知识，服务之间通过不同的网络协议进行交互，例如。HTTP协议，IP协议等。Java面试中，网络支持被考到的几率非常大，首先你应该深刻理解网络的四七层模型，这是网络知识的基础。另外两个非常重要的网络协议就是HTTP和TCP了，这两个协议也是服务交互中使用最多的协议。
先来看看TCP协议。TCP协议中的三次握手，建联与四次挥手断联是一个高频考点，后面的详解中，我会详细介绍。TCP的报文状态，标志与连接状态，在排查网络问题时非常重要，必须要明白协议状态才方便抓包分析。另一个知识点是nagel算法和ACK延迟，需要了解，产生的背景是要解决小包问题，提高数据载荷比，知道对于延迟比较敏感，且发送数据频率较低的场景可以关闭negel算法，关于TCP中keep alive是一种长时间没有数据发送的场景下TCP保持连接可用的机制，需要知道TCP keep alive的开启和设置方式，
最后一点需要明白TCP是如何通过滑动窗口机制来实现流量控制的。

再来看看HTTP协议部分。这里需要掌握HTTP协议的规范，知道协议中的method header cookies，需要了解常见的状态码含义，例如404,503,302等。另外，还有HTTPS的交互流程也需要了解。HTTP2协议目前还比较新，对于HTTP2协议的了解，可以在一定程度上体现对新技术的关注程度，可以关注HTTP2多路复用，Stream流式交互，流量控制，服务端推送，头部压缩等新特性。除了HTTP和TCP外，UDP也是一个比较常见的传输层协议，UDP的特点是非连接，非可靠传输，但是效率非常高。最后可以对QUIC协议进行一些了解，QUIC协议已经被标准化为HTTP3协议。QUIC是基于UDP协议的，但QUIC提供了类似TCP的可靠性保障和流量控制，QUIC可以有效避免HTTP2协议的前续包阻塞问题，能实现零RTT建联，提供FEC前向纠错能力，我们来看一下TCP协议的知识点。tcp传输层协议对应osi网络模型的第四层传输层,tcp协议的特点是基于链接也就是传输数据前需要先建立好链接然后再进行传输tcp连接一旦建立就可以在连接上进行双向的通信tcp的传输是基于字节流而不是报文将数据按自己的大小进行编号接收端通过ack来确认收到的数据编号,通过这种机制tcp协议能够保证接收数据的有序性和完整性,因此tcp能够提供可靠性传输tcp还能提供流量控制能力,通过滑动窗口来控制数据的发送速率,滑动窗口的本质是动态缓冲区,接收端根据自己的处理能力在tcp的hide中动态调整窗口大,小通过ac ca应答包通知给发送端,发送端通过包大小，来控制流量
仅仅有了控制流量还不够

TCP协议还考虑到了网络问题，可能会导致大量重传，进而导致网络情况进一步恶化，因此TCP协议还提供了拥塞控制。TCP处理拥塞控制主要是用到了慢启动拥塞，避免拥塞发生，快速恢复这个算法，感兴趣的同学可以做进一步的了解，除了TCP协议的特点，还可以进一步了解TCP协议的报文状态，滑动窗口的工作流程，keep-live的参数设置和nagel算法的规则等一些细节。另外还有典型的TCP协议问题，例如特定场景下nagel和Ack延迟机制配合使用，可能会出现延迟40毫秒，超时后才能回复ack包的问题。接下来我们来看看TCP建连的三次握手。

（TCP是基于链接的，所以在传输数据前需要先建立链接。tcp在传输上是双工传输，不区分client端和server端，为了便于理解我们把主动发起建链请求的一端称作client端，把被动建立连接的一端称作server端。看下面这张图，建联的时序是从上到下，左右两边的绿色字分别代表client端与server端当时的链接状态，首先建立链接前需要server端监听端口，因此，server端建立链接前的初始状态就是listen状态，这时候client端，准备建立链接，先发送一个SYN同步包，发送完同步包后Client端的链接状态就变成了syn_sent状态。server端收到SYN后，同意建立链接，会向client端回复一个ack。由于TCP双工传输server端也会同时向client端发送一个同步请求，SYN申请server向client方向建立连接，发送完ACK和SYN后，Server端的链接状态就变成了SYN_received。client收到server的ack后client端的链接状态就变成了established状态，同时client端向server端发送ack响应，回复server端的syn请求。server端收到client端ack后，Server端的链接状态也就变成了established状态此时建立连接完成双方随时可以进行数据传输。[已经使用] ）
(
在面试时需要明白三次握手是为了建立双向的连接。需要记住client端和server端的链接状态变化另外回答建联的问题时可以提到syn洪水攻击发生的原因就是server端收到client端的 syn请求后发送ack 和syn，但是client端不进回复。导致server端大量的链接处在syn_RCVD状态进而影响其他正常请求的建立。可以通过设置linux的tcp参数syn_ack_retreat=0来加快半连接的回收速度，或者调大max_syn_backLog来应对少量的SYN洪水攻击，再来看看TCP的断链，TCP链接关闭，通信双方都可以先发起，我们暂且把先发起的一方看做client，从图中可以看出，通信中的client和server两端的链接状态都是established状态。然后client端先发起了关闭连接请求，client向server发送了一个SYN包，表示client已经没有数据要发送，然后client端就进入了FIN_WAIT1的状态。server端收到SYN后返回ACK然后进入close_wait状态,此时server端属于半关闭状态因为此时client端向server方向已经不会再发送数据了，可是server向client端可能还有数据要发送，等到server端数据发送完毕后Server端会向client端发送FIN表示server端也没有数据要发送。这时Server端进入last_ack状态就等待应答就可以关闭链接了，client端收到所有的FIN后回复ack然后进入time_wait状态,time_wait的状态下需要等待两倍的msl(就是最大报文段生存时间)来保证链接的可靠关闭,之后才会进入close状态。而server端收到ack后直接就可以进入close状态。
[已经使用])

这里面试官可能会问，为什么需要等待两倍的MSL之后才能关闭链接，原因有两个，
第一，要保证TCP协议的全双工链接能够可靠关闭；第二。要保证这次链接中重复的数据段能够从网络中消失，防止端口被重用的时候可能会产生数据混淆。从这个交互流程上可以看出，无论是建立连接还是断连，都是需要在两个方向上进行，只不过建连时，Server端的syn和ack2个包儿合并为一次发送，而断开链接时，两个方向的数据发送的停止时间可能是不同的，所以无法合并fin和ack一起发送，这就是建连的时候必须要三次握手，断连的时候必须要四次的原因。

另外，在回答断连的问题时，可以提到实际应用中有可能会遇到大量socket处在time_wait或者close_wait状态的问题，一般开启Linux的TCP参数tw_reuse和tw_recycle能够加快time_wait状态的回收。而出现大量的close_wait状态，一般是被动关闭地方可能存在代码的bug，没有正确关闭链接导致的。

前面说了操作系统和网络知识，第三个是设计模式的考察点，一般有两个，一个是常用设计模式的实现，另外一个是设计模式的使用场景，也就是每个设计模式用来解决什么样的问题，在什么场景下，该使用什么样的设计模式，最常见的设计模式，单例模式，工厂模式，代理模式，工作者模式，责任链模式，适配器模式，观察者模式等

详解设计模式的知识点分为三大类型，共23种，
其中创建型的有五种，
工厂方法模式，抽象工厂模式，单例模式，建造者模式，原型模式，
结构性的有七种适配器模式，装饰器模式，代理模式，外观模式，桥接模式，组合模式，享元模式，
行为型的有时一种:策略模式，模板方法模式，观察者模式,迭代者模式，责任链模式，命令模式，备忘录模式，状态模式，访问者模式，中介者模式和解释器模式。

面试中，对于设计模式，你应该明白不同设计用来解决什么样的场景问题，对于常用的设计模式能够灵活运用，重点介绍几种常用的设计模式，
首先是工厂模式，这个模式在实际业务中经常会用到，也是设计模式中的主要考察点，这里我只介绍线程安全的单例模式的实现方式。单例模式常见的实现有三种，
第一种是静态初始化方式，也叫做饿汉方式，实现的思路就是在那初始化时完成单例实例的创建，因此不会产生并发问题，这种方式下不管是否会使用到这个单例，都会创建这个单里。
第二种实现方式是双重检查，也叫做懒汉方式，只有在真正用到这个单例实例的时候才会去创建，如果没有使用就不会创建，这个方式，必然会面对多个线程同时使用实例时的并发问题。为了解决并发访问问题通过synchronized的或者lock进行双重检查保证只有一个线程能够创建实例这里需要注意内存可见性引起的并发问题必须使用volatile关键字修饰单利变量。
第三种是单利注册表方式，Spring中的bean单例模式就是通过当地注册表方式实现我再结合设计模式的实际，应用来介绍一下其他常用的设计模式，
你在面试时遇到类似问题，也记得要将设计模式与实际业务场景进行结合，来体现对设计模式的理解和应用能力，首先是工厂模式，这个是创建不同类型实例常用的方式，例如spring中的各种bean是有不同的工厂类进行创建的。
第二个是代理模式，主要用在不适合或者不能直接引用另一个对象的场景，可以通过代理模式会被代理的对象进行访问行为的控制。Java的代理模式分为静态代理和动态代理。静态代理是指在编译时就已经创建好了代理类，例如我们在源代码中编写的类动态代理，只在JVM运行过程中动态创建代理类，使用动态代理的方法有JDK动态代理，CGlib JavaSysit等，面试时遇到这个问题，可以举个动态代理的例子，比如在motanRPC中使用JDK的动态代理，通过反射把远程请求进行封装，使服务看上去就像在使用本地的方法。
第三个是责任链模式，责任链模式有点像工厂的流水线，链上每一个节点完成对对象的某一种处理，例如netty框架在处理消息时使用的pipleLine就是一种责任链模式。
第四个是适配器模式，类似于我们常见的转接头，把两种不匹配的对象来进行适配，也可以起到对两个不同的对象进行解耦的作用。例如我们常用的日志处理框架，SLF4j。如果我们使用了SLF4j，就可以跟log4g或者那个logback这种具体的日志实现框架进行解耦，通过不同适配器将SF4g与logback等实现框架进行适配，完成日志功能的使用。
第五个是观察者模式也被称作发布订阅模式，适用于一个对象的某个行为需要触发一系列的事件场景，例如GRPC中stream流式的请求的处理就是通过观察者模式实现的。
第六个是构造者模式，适用于一个对象，有很多复杂的属性，需要根据不同情况创建不同的具体对象。例如创建一个PB对象时可以使用builder方式，

最后是Java语言的特性，常用集合类实现与Java并发工具包，JUC是常见的考点，关于JUC我会在后面的多线程课程中详细介绍
Java的集合，
这部分需要重点了解类的实现，例如HashMap,conturrentMap是如何实现的。动态代理反射是Java语言的特色，需要掌握动态代理与反射的使用场景，例如在orm框架中会大量使用带累啊，RPC调用时未使用反射机制调用实现类的方法。Java基础数据类型也常常会在面试中问到，例如每种数据类型占用多大的内存空间，数据类型的自动转换与强制转换，基础数据类型与Wapper数据类型的自动装箱与拆箱等等。java对象的引用分为强引用，软引用，弱引用，虚引用四种，这些引用在GC时的处理策略不同，强引用不会被GC回收软引用，软引用在内存空间不足时会被GC回收引用，弱引用在每次GC时都会被回收，虚引用必须和引用队列联合使用，主要用于跟踪一个对象被垃圾回收的过程。Java的异常处理机制就是try-catch，只需要知道异常时在try-catch中的处理流程，需要了解Error和exception的区别，最后Java的注解机制和SPI扩展机制可以作为扩展点，适当了解

关于Java的基础知识，重点讲一下最常考查的知识点，HashMap和ConturrentMap以及Java的不同版本，新技术特性。Map实现这个题目能够考察到数据结构，Java基础实现以及对并发问题的处理思路的掌握程度。现来看HashMap的实现，简单来说，Java的Hashmap就是数组加链表，实现数组中的每一项是一个链表，通过计算存入对象的hashcode来计算出对象在数组中要存入的位置。用链表来解决散列冲突，链表中的结点存储的是键值对。除了实现的方式，我们还需要知道填充因子的作用，与Map扩容时的rehash机智。需要知道HashMap容量都是二的幂次方.是因为可以通过按位与操作来计算余数比求模要更快，另外需要知道hashmap是非线程安全的，在多线程put的情况下，有可能在容量超过填充因子时进行rehash。因为Hashmap为了避免每次尾部遍历，在链表的插入时使用的是头插法，多线程场景下可能会产生死循环。HashMap的非线程安全，面试官很自然的就会问到线程安全的concurrentHashMap。ConcurrentHashMap使用的是分段锁的思想来降低并发场景下的锁定发生频率，在JDK1.7和1.8中的实现差异非常大。1.7中使用的segment进行分段加锁，降低并发锁定程度，1.8中使用CAS自旋锁，这是一种乐观锁模式来提高性能。但是在并发度较高的场景下，性能会比较一般。

另外1.8中，currenthashMap中引入红黑树，用来解决哈希冲突时列表的顺序查找问题。红黑树的启用条件与链表的长度和map的总容量有关，默认是列表大于8，且容量大约64转为红黑树方式，这部分内容建议详细阅读源码进行学习。java近些年一改以往的版本发布风格，发布频率提高了很多，目前大部分公司的生产环境使用的还是1.8版本，一少部分公司升级到1.9或者1.10,Java的1.8版本是个长期支持版本，最新发布的1.1也是一个长期支持版本，所以这两个版本是我们要重点关注的版本。在1.8版本中，Java增加了lambda表达式的支持，是Java代码的编写，可以更简洁，也更方便支持并行计算。1.8提供了很多stream流式处理API还支持的方法，引用的能力可以进一步简化lambda表达式的写法。1.8中接口可以提供默认方法，这样可以简化掉一些简单的抽象类，之后在1.8中对方法区进行了调整，使用matespace替换掉了Permgeneration的永久代。Matespace与Permgeneration之间最大的区别在于

mateSpace并不在虚拟机中，而是使用本地内存替换,这样做的目的，一方面是可以提升对元数据的处理，提升GC效率，另一方面方便后续hotspot与GRocket合并。在1.9和1.10中，主要的特性是增加了模块系统，将G1作为了默认的垃圾回收器，支持局部的变量推断等功能，这些功能都已经包含在1.1中。1.11版本是Java最新的长期支持版本，也会是将来一段时间的主要版本。1.11版本儿提供的最激动人心的功能就要数ZGC这个新的垃圾回收器了。ZGC对大内存有着非常强悍的性能，能够实现十毫秒以下的这些停顿，关于ZGC会在下一课中进行进一步的介绍。除此之外，1.11版本对字符串处理的API进行了增强，提供了字符复制等功能，1.1版本儿还内置了httpclient。以上是本节课对于计算机基础和Java语言特性画的重点，由于时间关系无法对每个细节都详细讲解，你可以在课后进行补充学习，

接下来我从面试官角度出发，总结本科的面试的考察点。第一个考察点就是对基本概念和基本原理的考查要求，这两项的理解必须是正确的，清洗的。例如网络协议的47层模型的概念，TCP协议流量控制的实现原理等。第二个考察点是常用工具模型，它的实现方式和使用姿势，例如hashMap在JDK1.8中的实现方式是怎样的，单例模式有哪几种实现方式，什么场景下，该使用静态方法实现什么场景下开始用双重检查实现。第三个考察点是经常使用到的一些知识点，例如你常用的Linux命令有哪些，都用来解决什么样的问题。第四个考察点是实际应用中容易犯错的点，例如==与equals()的区别是什么？例如对象的强引用使用不当可能会导致内存泄露，那主要考察候选人，对于不同对象引用方式的作用和理解。第五个考察点是与面试方向相关的知识点，例如面试的岗位是中间件研发，面试时可能会涉及更多的存储网络相关的知识考察。前面提到的考察点是面试通过的必要条件，回答出问题并不一定能保证通过面试，所以如何做到比其他竞争者更优秀，让面试官留下更好的印象是成功的关键，你需要一些buff。这些加分能力不仅仅，针对这一课的内容，后续课程也有一定的通用性，第一点能将面试的考察点与实际业务场景结合，或者与实际使用经验结合，这样能更好地体现你对知识点的理解，突出实践能力，
例如在回答你知道哪几种设计模式，这个问题是不但能说出几种设计模式及适合的场景，而且还能指出哪些著名的框架在处理什么样的问题时使用的哪一种设计模式，自己在处理某一个项目的什么场景时，使用的哪种设计模式取得了什么样的效果，这样肯定会给面试官留下非常好的印象。
第二点，用反例来描述实际场景中误用某些功能会带来的问题，例如介绍反射机制时，除了介绍反射机制的实现方式，应用场景外，还可以提到大量的使用反射会对性能产生影响，应避免滥用。

第三点知道与考察点相关的优化点，例如在介绍TCP建连，和断连时，最好能够指出线上如果出现大量time_wait的时，可以通过调整系统参数来加快链接的回收与复用

第四点，了解与知识点相关的最新技术趋势，例如介绍的concurrenthashMap时能够知道1.8版本的改进细节，或者在介绍HTTP协议时，能够说出http2或者QUIC的特点和实现等。

第五点，回答面试问题时，在比较了解的前提下，尽量增加回答内容的深度，例如在介绍TCP的滑动窗口时，能讲到流量与拥塞控制，进一步能指出不同的解决拥塞的算法，这里要注意，面试官一般会沿着候选人回答继续追问，如果对细节不太了解，可能会适得其反。最后的真题部分，我准备了一些面试比较高频的真题，方便你在课后进行巩固和练习。

一线程与进程的区别和联系，主要从资源的占用，切换效率，通讯方式等方面进行解答。
第二题，线程的切换过程主要考察线程上下文切换代价。要回答切换会保存，寄存器站等，现行相关的现场，需要由用户太切换到那和泰，最后，要知道，可以通过VS state的命令查看线程上下文切换状况。
第三题，常用的Linux命令可以参考前面操作系统汇总中我提到的那些命令。第四五题知识点详解中已经介绍过了，这个务必要掌握。
第六题大致包括DNS解析，TCP建联请求HTTP请求响应

实际回答时可以换个简单的交互图来说明
#### 面试问题
#### 加分项